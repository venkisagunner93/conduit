<svg viewBox="0 0 800 520" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="800" height="520" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="18" font-weight="bold" fill="#1e293b">Ring Buffer Wrapping</text>
  
  <!-- Formula -->
  <text x="400" y="55" text-anchor="middle" font-family="monospace" font-size="12" fill="#7c3aed">slot = message_number % slot_count</text>
  
  <!-- ==================== State 1 ==================== -->
  <text x="50" y="95" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#374151">Messages 0â€“3</text>
  <text x="700" y="95" text-anchor="end" font-family="monospace" font-size="11" fill="#64748b">write_idx = 4</text>
  
  <g transform="translate(50, 110)">
    <rect x="0" y="0" width="170" height="55" fill="#bfdbfe" stroke="#3B82F6" stroke-width="2" rx="4"/>
    <text x="85" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#1e40af">slot 0</text>
    <text x="85" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#3B82F6">msg #0</text>
    
    <rect x="175" y="0" width="170" height="55" fill="#bfdbfe" stroke="#3B82F6" stroke-width="2" rx="4"/>
    <text x="260" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#1e40af">slot 1</text>
    <text x="260" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#3B82F6">msg #1</text>
    
    <rect x="350" y="0" width="170" height="55" fill="#bfdbfe" stroke="#3B82F6" stroke-width="2" rx="4"/>
    <text x="435" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#1e40af">slot 2</text>
    <text x="435" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#3B82F6">msg #2</text>
    
    <rect x="525" y="0" width="170" height="55" fill="#bfdbfe" stroke="#3B82F6" stroke-width="2" rx="4"/>
    <text x="610" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#1e40af">slot 3</text>
    <text x="610" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#3B82F6">msg #3</text>
  </g>
  
  <!-- ==================== State 2 ==================== -->
  <line x1="50" y1="190" x2="750" y2="190" stroke="#e2e8f0" stroke-width="1"/>
  
  <text x="50" y="220" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#374151">Message #4 arrives</text>
  <text x="700" y="220" text-anchor="end" font-family="monospace" font-size="11" fill="#64748b">write_idx = 5</text>
  
  <g transform="translate(50, 235)">
    <rect x="0" y="0" width="170" height="55" fill="#fecaca" stroke="#ef4444" stroke-width="2" rx="4"/>
    <text x="85" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#b91c1c">slot 0</text>
    <text x="85" y="42" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#dc2626">msg #4</text>
    
    <rect x="175" y="0" width="170" height="55" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="260" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">slot 1</text>
    <text x="260" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">msg #1</text>
    
    <rect x="350" y="0" width="170" height="55" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="435" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">slot 2</text>
    <text x="435" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">msg #2</text>
    
    <rect x="525" y="0" width="170" height="55" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="610" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">slot 3</text>
    <text x="610" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">msg #3</text>
  </g>
  
  <text x="135" y="310" text-anchor="middle" font-family="monospace" font-size="9" fill="#b91c1c">4 % 4 = 0</text>
  
  <!-- ==================== State 3 ==================== -->
  <line x1="50" y1="330" x2="750" y2="330" stroke="#e2e8f0" stroke-width="1"/>
  
  <text x="50" y="360" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#374151">After 1000 messages</text>
  <text x="700" y="360" text-anchor="end" font-family="monospace" font-size="11" fill="#64748b">write_idx = 1000</text>
  
  <g transform="translate(50, 375)">
    <rect x="0" y="0" width="170" height="55" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="85" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">slot 0</text>
    <text x="85" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">msg #996</text>
    
    <rect x="175" y="0" width="170" height="55" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="260" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">slot 1</text>
    <text x="260" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">msg #997</text>
    
    <rect x="350" y="0" width="170" height="55" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="435" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">slot 2</text>
    <text x="435" y="42" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">msg #998</text>
    
    <rect x="525" y="0" width="170" height="55" fill="#bfdbfe" stroke="#3B82F6" stroke-width="2" rx="4"/>
    <text x="610" y="22" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#1e40af">slot 3</text>
    <text x="610" y="42" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#3B82F6">msg #999</text>
  </g>
  
  <text x="135" y="450" text-anchor="middle" font-family="monospace" font-size="9" fill="#64748b">996 % 4 = 0</text>
  <text x="310" y="450" text-anchor="middle" font-family="monospace" font-size="9" fill="#64748b">997 % 4 = 1</text>
  <text x="485" y="450" text-anchor="middle" font-family="monospace" font-size="9" fill="#64748b">998 % 4 = 2</text>
  <text x="660" y="450" text-anchor="middle" font-family="monospace" font-size="9" fill="#64748b">999 % 4 = 3</text>
  
  <!-- Legend -->
  <g transform="translate(50, 480)">
    <rect x="0" y="0" width="16" height="16" fill="#bfdbfe" stroke="#3B82F6" stroke-width="1" rx="2"/>
    <text x="22" y="13" font-family="system-ui, sans-serif" font-size="10" fill="#374151">Latest write</text>
    
    <rect x="130" y="0" width="16" height="16" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="1" rx="2"/>
    <text x="152" y="13" font-family="system-ui, sans-serif" font-size="10" fill="#374151">Old data</text>
    
    <rect x="250" y="0" width="16" height="16" fill="#fecaca" stroke="#ef4444" stroke-width="1" rx="2"/>
    <text x="272" y="13" font-family="system-ui, sans-serif" font-size="10" fill="#374151">Overwrite</text>
  </g>
</svg>
