<svg viewBox="0 0 800 580" xmlns="http://www.w3.org/2000/svg">
  <rect width="800" height="580" fill="#f8fafc"/>
  
  <text x="400" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="18" font-weight="bold" fill="#1e293b">Futex: How Subscriber Waits for Data</text>
  
  <text x="40" y="65" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#374151">Subscriber caught up - no new data</text>
  
  <g transform="translate(40, 85)">
    <rect x="0" y="0" width="85" height="50" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="42" y="20" text-anchor="middle" font-family="monospace" font-size="9" fill="#6366f1">msg #98</text>
    <text x="42" y="38" text-anchor="middle" font-family="monospace" font-size="8" fill="#6366f1">read</text>
    
    <rect x="90" y="0" width="85" height="50" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="132" y="20" text-anchor="middle" font-family="monospace" font-size="9" fill="#6366f1">msg #99</text>
    <text x="132" y="38" text-anchor="middle" font-family="monospace" font-size="8" fill="#6366f1">read</text>
    
    <rect x="180" y="0" width="85" height="50" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2" rx="4"/>
    <text x="222" y="30" text-anchor="middle" font-family="monospace" font-size="9" fill="#94a3b8">empty</text>
    
    <rect x="270" y="0" width="85" height="50" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2" rx="4"/>
    <text x="312" y="30" text-anchor="middle" font-family="monospace" font-size="9" fill="#94a3b8">empty</text>
  </g>
  
  <g transform="translate(400, 80)">
    <rect x="0" y="0" width="180" height="60" fill="#fef9c3" stroke="#eab308" stroke-width="2" rx="4"/>
    <text x="90" y="18" text-anchor="middle" font-family="monospace" font-size="10" fill="#a16207">write_idx  = 100</text>
    <text x="90" y="35" text-anchor="middle" font-family="monospace" font-size="10" fill="#a16207">read_idx   = 100</text>
    <text x="90" y="52" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#a16207">futex_word = 100</text>
  </g>
  
  <text x="620" y="115" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#dc2626">read == write</text>
  <text x="620" y="135" font-family="system-ui, sans-serif" font-size="12" fill="#dc2626">nothing to read!</text>
  
  <rect x="40" y="155" width="720" height="35" fill="#fef2f2" stroke="#fca5a5" stroke-width="2" rx="6"/>
  <text x="400" y="178" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#b91c1c">No new data. What should subscriber do while waiting?</text>
  
  <g transform="translate(40, 205)">
    <rect x="0" y="0" width="230" height="110" fill="#fee2e2" stroke="#fca5a5" stroke-width="2" rx="6"/>
    <text x="115" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#b91c1c">Busy Wait</text>
    <text x="15" y="45" font-family="monospace" font-size="9" fill="#dc2626">while (read == write) {</text>
    <text x="15" y="60" font-family="monospace" font-size="9" fill="#dc2626">  // check again...</text>
    <text x="15" y="75" font-family="monospace" font-size="9" fill="#dc2626">}</text>
    <text x="115" y="100" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#b91c1c">Burns 100% CPU</text>
  </g>
  
  <g transform="translate(285, 205)">
    <rect x="0" y="0" width="230" height="110" fill="#fef3c7" stroke="#fcd34d" stroke-width="2" rx="6"/>
    <text x="115" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#b45309">Sleep</text>
    <text x="15" y="45" font-family="monospace" font-size="9" fill="#d97706">while (read == write) {</text>
    <text x="15" y="60" font-family="monospace" font-size="9" fill="#d97706">  sleep(10ms);</text>
    <text x="15" y="75" font-family="monospace" font-size="9" fill="#d97706">}</text>
    <text x="115" y="100" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#b45309">Up to 10ms late</text>
  </g>
  
  <g transform="translate(530, 205)">
    <rect x="0" y="0" width="230" height="110" fill="#d1fae5" stroke="#10B981" stroke-width="2" rx="6"/>
    <text x="115" y="22" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#065f46">Futex</text>
    <text x="15" y="45" font-family="monospace" font-size="9" fill="#059669">while (read == write) {</text>
    <text x="15" y="60" font-family="monospace" font-size="9" fill="#059669">  futex_wait(fw, 100);</text>
    <text x="15" y="75" font-family="monospace" font-size="9" fill="#059669">} // wake me if fw!=100</text>
    <text x="115" y="100" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#065f46">0% CPU, 2us wake</text>
  </g>
  
  <line x1="40" y1="335" x2="760" y2="335" stroke="#e2e8f0" stroke-width="1"/>
  <text x="40" y="365" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#374151">Publisher writes new data</text>
  
  <g transform="translate(40, 385)">
    <rect x="0" y="0" width="85" height="50" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="42" y="30" text-anchor="middle" font-family="monospace" font-size="9" fill="#6366f1">msg #98</text>
    
    <rect x="90" y="0" width="85" height="50" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="132" y="30" text-anchor="middle" font-family="monospace" font-size="9" fill="#6366f1">msg #99</text>
    
    <rect x="180" y="0" width="85" height="50" fill="#bfdbfe" stroke="#3B82F6" stroke-width="3" rx="4"/>
    <text x="222" y="22" text-anchor="middle" font-family="monospace" font-size="9" font-weight="bold" fill="#1e40af">msg #100</text>
    <text x="222" y="40" text-anchor="middle" font-family="monospace" font-size="8" fill="#3B82F6">NEW!</text>
    
    <rect x="270" y="0" width="85" height="50" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2" rx="4"/>
    <text x="312" y="30" text-anchor="middle" font-family="monospace" font-size="9" fill="#94a3b8">empty</text>
  </g>
  
  <g transform="translate(400, 380)">
    <rect x="0" y="0" width="180" height="60" fill="#d1fae5" stroke="#10B981" stroke-width="2" rx="4"/>
    <text x="90" y="18" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#065f46">write_idx  = 101</text>
    <text x="90" y="35" text-anchor="middle" font-family="monospace" font-size="10" fill="#065f46">read_idx   = 100</text>
    <text x="90" y="52" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#065f46">futex_word = 101</text>
  </g>
  
  <g transform="translate(600, 380)">
    <text x="0" y="15" font-family="monospace" font-size="10" fill="#3B82F6">write(data)</text>
    <text x="0" y="32" font-family="monospace" font-size="10" fill="#3B82F6">write_idx++</text>
    <text x="0" y="49" font-family="monospace" font-size="10" fill="#065f46">futex_word++</text>
    <text x="0" y="66" font-family="monospace" font-size="10" fill="#10B981">futex_wake()</text>
  </g>
  
  <rect x="40" y="460" width="720" height="35" fill="#d1fae5" stroke="#10B981" stroke-width="2" rx="6"/>
  <text x="400" y="483" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" fill="#065f46">futex_word changed (100 to 101) - Kernel wakes subscriber - reads msg #100</text>
  
  <text x="400" y="530" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#64748b">Subscriber passed futex_wait(fw, 100). Kernel sees fw is now 101, wakes subscriber immediately.</text>
</svg>
