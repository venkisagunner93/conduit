<svg viewBox="0 0 800 520" xmlns="http://www.w3.org/2000/svg">
  <rect width="800" height="520" fill="#f8fafc"/>
  
  <text x="400" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="18" font-weight="bold" fill="#1e293b">Sequence Numbers: Detecting Overwrites</text>
  
  <!-- Problem setup -->
  <text x="40" y="65" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#374151">Slow subscriber is behind</text>
  
  <!-- Ring buffer with sequence numbers -->
  <g transform="translate(40, 85)">
    <rect x="0" y="0" width="130" height="70" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="65" y="20" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">slot 0</text>
    <text x="65" y="40" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">seq = 96</text>
    <text x="65" y="58" text-anchor="middle" font-family="monospace" font-size="9" fill="#6366f1">imu data...</text>
    
    <rect x="140" y="0" width="130" height="70" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="205" y="20" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">slot 1</text>
    <text x="205" y="40" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">seq = 97</text>
    <text x="205" y="58" text-anchor="middle" font-family="monospace" font-size="9" fill="#6366f1">imu data...</text>
    
    <rect x="280" y="0" width="130" height="70" fill="#fecaca" stroke="#ef4444" stroke-width="3" rx="4"/>
    <text x="345" y="20" text-anchor="middle" font-family="monospace" font-size="10" fill="#b91c1c">slot 2</text>
    <text x="345" y="40" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#b91c1c">seq = 98</text>
    <text x="345" y="58" text-anchor="middle" font-family="monospace" font-size="9" fill="#b91c1c">imu data...</text>
    
    <rect x="420" y="0" width="130" height="70" fill="#e0e7ff" stroke="#a5b4fc" stroke-width="2" rx="4"/>
    <text x="485" y="20" text-anchor="middle" font-family="monospace" font-size="10" fill="#6366f1">slot 3</text>
    <text x="485" y="40" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#6366f1">seq = 99</text>
    <text x="485" y="58" text-anchor="middle" font-family="monospace" font-size="9" fill="#6366f1">imu data...</text>
  </g>
  
  <!-- State box -->
  <g transform="translate(590, 85)">
    <rect x="0" y="0" width="170" height="70" fill="#fef9c3" stroke="#eab308" stroke-width="2" rx="4"/>
    <text x="85" y="25" text-anchor="middle" font-family="monospace" font-size="10" fill="#a16207">write_idx = 100</text>
    <text x="85" y="45" text-anchor="middle" font-family="monospace" font-size="10" fill="#a16207">read_idx  = 90</text>
    <text x="85" y="62" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#a16207">(wants msg #90)</text>
  </g>
  
  <!-- Subscriber tries to read -->
  <line x1="40" y1="175" x2="760" y2="175" stroke="#e2e8f0" stroke-width="1"/>
  <text x="40" y="205" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#374151">Subscriber tries to read message #90</text>
  
  <g transform="translate(40, 225)">
    <rect x="0" y="0" width="350" height="100" fill="#fff" stroke="#e2e8f0" stroke-width="1" rx="6"/>
    <text x="20" y="25" font-family="monospace" font-size="10" fill="#374151">want_msg = 90</text>
    <text x="20" y="45" font-family="monospace" font-size="10" fill="#374151">slot = 90 % 4 = 2</text>
    <text x="20" y="65" font-family="monospace" font-size="10" fill="#374151">read slot[2].sequence</text>
    <text x="20" y="85" font-family="monospace" font-size="10" font-weight="bold" fill="#b91c1c">got 98, expected 90</text>
  </g>
  
  <!-- Result -->
  <g transform="translate(410, 225)">
    <rect x="0" y="0" width="350" height="100" fill="#fef2f2" stroke="#fca5a5" stroke-width="2" rx="6"/>
    <text x="175" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#b91c1c">OVERWRITTEN!</text>
    <text x="175" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#b91c1c">seq 98 != 90</text>
    <text x="175" y="80" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#b91c1c">Message #90 is gone forever</text>
  </g>
  
  <!-- Recovery -->
  <line x1="40" y1="345" x2="760" y2="345" stroke="#e2e8f0" stroke-width="1"/>
  <text x="40" y="375" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#374151">Subscriber skips to oldest available</text>
  
  <g transform="translate(40, 395)">
    <rect x="0" y="0" width="350" height="80" fill="#fff" stroke="#e2e8f0" stroke-width="1" rx="6"/>
    <text x="20" y="25" font-family="monospace" font-size="10" fill="#374151">oldest = write_idx - slot_count</text>
    <text x="20" y="45" font-family="monospace" font-size="10" fill="#374151">oldest = 100 - 4 = 96</text>
    <text x="20" y="65" font-family="monospace" font-size="10" font-weight="bold" fill="#059669">read_idx = 96</text>
  </g>
  
  <g transform="translate(410, 395)">
    <rect x="0" y="0" width="350" height="80" fill="#d1fae5" stroke="#10B981" stroke-width="2" rx="6"/>
    <text x="175" y="30" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#065f46">Recovery</text>
    <text x="175" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#065f46">Skip messages 90-95 (lost)</text>
    <text x="175" y="75" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#065f46">Continue from message 96</text>
  </g>
  
  <!-- Bottom summary -->
  <text x="400" y="505" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#64748b">Sequence number in each slot lets subscriber detect if data was overwritten while it was slow</text>
</svg>
